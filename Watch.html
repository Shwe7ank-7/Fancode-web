<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Live - @shwe7ank</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="referrer" content="no-referrer">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/plyr@3.7.8/dist/plyr.css">
<script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.8/dist/hls.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/plyr@3.7.8/dist/plyr.min.js"></script>

<style>
html,body{margin:0;background:#000;color:#fff;font-family:system-ui}
.video-wrap{position:relative;max-width:100vw}
video{width:100%;height:auto;background:#000}

/* Match title overlay */
#matchOverlay{
  position:absolute;top:12px;left:12px;
  background:rgba(0,0,0,.65);
  padding:10px 14px;border-radius:8px;
  font-size:14px;z-index:10;
  animation:fadeOut 5s forwards 4s;
}
@keyframes fadeOut{to{opacity:0}}

/* Telegram popup */
#popup{
  position:fixed;inset:0;
  background:rgba(0,0,0,.85);
  display:flex;align-items:center;justify-content:center;
  z-index:999;
}
.popup-box{
  background:#FFD700;color:#000;
  padding:22px;border-radius:12px;
  width:320px;text-align:center;
}
.popup-box button{
  width:100%;margin-top:10px;
  padding:10px;border:none;
  border-radius:8px;font-weight:700;
}
.join{background:#000;color:#FFD700}
.close{background:#555;color:#fff}
</style>
</head>

<body>

<!-- Telegram popup -->
<div id="popup">
  <div class="popup-box">
    <h3>Support Us</h3>
    <p>Join Telegram for more live matches</p>
    <button class="join" onclick="window.open('https://t.me/+3sgGQcDP6ExhYTU1','_blank')">Join Telegram</button>
    <button class="close" onclick="popup.style.display='none'">Already Joined</button>
  </div>
</div>

<div class="video-wrap">
  <div id="matchOverlay"></div>
  <video id="player" controls playsinline></video>
</div>

<script>
const JSON_URL = "https://raw.githubusercontent.com/Jitendra-unatti/fancode/refs/heads/main/data/fancode.json";
const params = new URLSearchParams(location.search);
const matchId = params.get("id");
const preferredCDN = params.get("cdn");

const video = document.getElementById("player");
const overlay = document.getElementById("matchOverlay");

async function getSources(){
  const res = await fetch(JSON_URL);
  const data = await res.json();
  const match = data.matches.find(m => String(m.match_id) === matchId);
  if(!match) throw "Match not found";

  overlay.innerHTML = `
    <strong>${match.title}</strong><br>
    ${match.tournament} â€¢ LIVE
  `;

  return [
    match.STREAMING_CDN?.Primary_Playback_URL,
    match.STREAMING_CDN?.fancode_cdn,
    match.STREAMING_CDN?.dai_google_cdn,
    match.STREAMING_CDN?.cloudfront_cdn,
    match.STREAMING_CDN?.sony_cdn
  ].filter(Boolean);
}

async function play(){
  const sources = await getSources();
  let index = 0;

  function tryPlay(url){
    if(Hls.isSupported()){
      const hls = new Hls({
        lowLatencyMode:true,
        backBufferLength:30
      });
      hls.loadSource(url);
      hls.attachMedia(video);

      hls.on(Hls.Events.MANIFEST_PARSED,()=>{
        const qualities = hls.levels.map(l=>l.height).filter(Boolean);
        new Plyr(video,{
          controls:['play','progress','mute','volume','settings','fullscreen'],
          quality:{
            default:Math.max(...qualities),
            options:qualities,
            forced:true,
            onChange:q=>{
              hls.levels.forEach((l,i)=>{
                if(l.height===q) hls.currentLevel=i;
              });
            }
          }
        });
        video.play().catch(()=>video.muted=true);
      });

      hls.on(Hls.Events.ERROR,(e,d)=>{
        if(d.fatal){
          index++;
          if(index<sources.length) tryPlay(sources[index]);
        }
      });
    }
  }

  tryPlay(sources[index]);
}

play();

/* auto soft refresh every 6 min */
setInterval(()=>location.reload(),360000);
</script>

</body>
</html>
